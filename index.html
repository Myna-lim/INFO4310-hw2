<!DOCTYPE html>
<html>
    <head>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="https://d3js.org/topojson.v3.min.js"></script>
        <style>
            .right-aligned {
                float: right;
                margin-left: 20px;
                width: 800px;
            }
            body{
                font-family:Helvetica, sans-serif;
                margin: 50px;
                background-color: rgb(186, 224, 237);
            }
            .belly{
                position: relative;
                width: 1400px;
            }
            .belly-chart{
                position: absolute;
            }
            .main-content{
                display: flex;
                flex-direction: row;
            }
            .left{
                width: 500px;
            }
        </style>
    </head>

    <body>
        <div class = "main-content">
            <div class = "left">
                <h1> Popular Baby Names</h1>
                <p> Myna Lim (ml2326) and Carly Hu (ch862)</p>
            </div>

        <div class = "belly">
            <img src="pregnant-candace.png" alt="pregnant candace" class="right-aligned"/>
            <svg class = "belly-chart" id = "belly-chart" height = "600" width = "600" style = "margin-left: 250px; margin-top: 280px">
            </svg>
        </div>

        <script>
            const svg = d3.select("#belly-chart");
            const Width = svg.attr("width");
            const Height = svg.attr("height");
            const belly = d3.select("#belly-chart").append("circle")
                .attr("cx", 275)
                .attr("cy", 275)   
                .attr("r", 275)
                .style("fill", "transparent")
                .attr("stroke","white");

            const requestData = async function() {
                //let Layer = d3.select("#belly-chart").append("g");
                //let Width = d3.select("#belly-chart").attr("width");
                //let Height = d3.select("#belly-chart").attr("height");


                const babies = await d3.csv('Popular_Baby_Names.csv');
                var filteredYear = babies.filter(function(d) {
                    return d["Year of Birth"] === "2011" &&  d["Rank"] < 10 ;
            
                });
               // console.log(babies);

                //scales
                const genderScale = d3.scaleOrdinal().domain(["MALE","FEMALE"]).range(["#259dc3","#f25a9e"]);


                //making data points
                filteredYear.forEach( d => {
                    d.x = d3.randomUniform(10,Width-10)();
                    d.y = d3.randomUniform(10,Height-10)();
                    console.log(d["Child's First Name"], d["Rank"])
                });

                let circles = svg.selectAll("circle").data(filteredYear)
                            .join("circle")
                            .attr("r", d => d.Count/10)
                            .attr("cx", d => d.x )
                            .attr("cy", d => d.y )
                            .attr("opacity", 0.6)
                            .attr("fill", d => genderScale( d.Gender ) )
      
                var babySimulation = d3.forceSimulation()
                                  .nodes(filteredYear)
                                  .force("ypos", d3.forceY()
                                                   .strength( 0.03 )
                                                   .y( Height/2.0 ) )
                                  .force("xpos", d3.forceX()
                                                   .strength( 0.03 )
                                                   .x( Width/2.0) )
                                  .force("collision", d3.forceCollide()
                                                        .radius(12)
                                                        .iterations(1) )
                                  .on("tick", updateAllBabyPositions);
      
                babySimulation.stop();
                function updateAllBabyPositions() {
                circles.attr("cx", d => d.x).attr("cy", d => d.y);
                    }
                babySimulation.restart();


                // hover functionality
                let label = svg.append("text").attr("visibility","hidden")         

                circles.on("mouseover", function() {
                    d3.select(this).attr("stroke", "white").attr("stroke-width", 3)

                    let name = d3.select(this).datum()["Child's First Name"]
                    let gender = d3.select(this).datum()["Gender"]
                    let rank = d3.select(this).datum()["Rank"]
                    let ethnicity = d3.select(this).datum()["Ethnicity"]
                    let count = d3.select(this).datum()["Count"]

                    let allInfo = "Name: " + name + "\nGender: "+ gender + "\nRank: "+ rank + "\nEthnicity: " + ethnicity + "\nCount" + count;
                    // the \n thing is supposed to make a new line but it's not working so plz help 

                    label.text(allInfo) 
                        .attr("x", 150) 
                        .attr("y", 450) 
                        .attr("visibility", "visible")
                        .style("font-weight", "bold")
                });

                circles.on("mouseout", function() {
                    d3.select(this).attr("stroke", "")
                    label.text(""); 
                });

            

            }
            requestData();
        </script>
        </div>

    </body>
</html>