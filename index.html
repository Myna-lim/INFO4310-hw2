<!DOCTYPE html>
<html>
    <head>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="https://d3js.org/topojson.v3.min.js"></script>
        <style>
            .right-aligned {
                float: right;
                margin-left: 20px;
                width: 800px;
            }
            body{
                font-family:Helvetica, sans-serif;
                margin: 50px;
                background-color: rgb(186, 224, 237);
            }
            .belly{
                position: relative;
                width: 1400px;
            }
            .belly-chart{
                position: absolute;
            }
            .main-content{
                display: flex;
                flex-direction: row;
            }
            .left{
                width: 500px;
            }
            .ranking{
                margin-top: 50;
                margin-right: 500px;
                width: 380px;
                height: 80px;
                /* flex-direction: row; */
                /* display: flex; */
                /* justify-content: center; */
            }
        </style>
    </head>

    <body>
        <div class = "main-content">
            <div class = "left">
                <h1> Popular Baby Names</h1>
                <p> Myna Lim (ml2326) and Carly Hu (ch862)</p>
            </div>

        <div class = "belly">
            <img src="pregnant-candace.png" alt="pregnant candace" class="right-aligned"/>
            <svg class = "belly-chart" id = "belly-chart" height = "600" width = "600" style = "margin-left: 250px; margin-top: 280px">
            </svg>
            <div class = "ranking" style="border: 2px solid #7a0177; padding-top: 200px; "></div>
            
      
        </div>

        <script>
            const svg = d3.select("#belly-chart");
            const Width = svg.attr("width");
            const Height = svg.attr("height");
            // const belly = d3.select("#belly-chart").append("circle")
            //     .attr("cx", 275)
            //     .attr("cy", 275)   
            //     .attr("r", 275)
            //     .style("fill", "transparent")
            //     .attr("stroke","white");
            const belly = svg.append("g") // Append a group element to the SVG
                .attr("class", "belly")
                .attr("transform", "translate(290, 285)"); // Translate to the center of the SVG

            // Adding a circle to represent the belly
            belly.append("circle")
                .attr("r", 290)
                .style("fill", "transparent")
                //.attr("stroke", "blue");
            

            const requestData = async function() {
                //let Layer = d3.select("#belly-chart").append("g");
                //let Width = d3.select("#belly-chart").attr("width");
                //let Height = d3.select("#belly-chart").attr("height");


                const babies = await d3.csv('Preprocessed_Popular_Baby.csv');
                babies.forEach(function(d) {
                d["Year of Birth"] = parseInt(d["Year of Birth"]); 
                d["ASIAN AND PACIFIC ISLANDER"] = parseInt(d["ASIAN AND PACIFIC ISLANDER"]); 
                d["BLACK NON HISPANIC"] = parseInt(d["BLACK NON HISPANIC"]); 
                d["HISPANIC"] = parseInt(d["HISPANIC"]); 
                d["WHITE NON HISPANIC"] = parseInt(d["WHITE NON HISPANIC"]); 
                d["overall_count"] = parseInt(d["overall_count"]); 
                d["rank"] = parseFloat(d["rank"]);
                });
                var filteredYear = babies.filter(function(d) {
                    return d["Year of Birth"] === "2011" &&  d["rank"] < 40 ;
            
                });
               // console.log(babies);

                //scales
                const genderScale = d3.scaleOrdinal().domain(["MALE","FEMALE"]).range(["#259dc3","#f25a9e"]);


                //making data points
                filteredYear.forEach( d => {
                    d.x = d3.randomUniform(10,Width-1500)();
                    d.y = d3.randomUniform(10,Height-1500)();
                    console.log(d["Child's First Name"], d["rank"])
                });

                // let circles = svg.selectAll("circle").data(filteredYear)
                //             .join("circle")
                //             .attr("xlink:href", "girl.png")
                //             .attr("r", d => d.overall_count/1300)
                //             .attr("cx", d => d.x )
                //             .attr("cy", d => d.y )
                //             .attr("opacity", 0.6)
                //             .attr("fill", d => genderScale( d.Gender ) );

                let images = belly.selectAll("image")
                            .data(filteredYear)
                            .join("image")
                            .attr("xlink:href", d => d.Gender === "MALE" ? "boy.png" : "girl.png")
                            .attr("width", d => d.overall_count / 700) // Adjust the width as needed
                            .attr("height", d => d.overall_count / 700) // Adjust the height as needed
                            .attr("x", d => d.x)
                            .attr("y", d => d.y)
                            .attr("opacity", 0.6);
      
                var babySimulation = d3.forceSimulation()
                                  .nodes(filteredYear)
                                  .force("ypos", d3.forceY()
                                                   .strength( 0.0123 )
                                                   .y( Height/2.0 ) )
                                  .force("xpos", d3.forceX()
                                                   .strength( 0.0123 )
                                                   .x( Width/2.0)  )
                                  .force("collision", d3.forceCollide()
                                                        .radius(function(d){return d.overall_count/2000;})
                                                        .iterations(1) )
                                  .on("tick", updateAllBabyPositions);
      
                babySimulation.stop();

                function updateAllBabyPositions() {
                    images.attr("x", d => d.x).attr("y", d => d.y);
                    }

                babySimulation.restart();

                // hover functionality
                let labelback= svg.append("rect").attr("visibility","hidden")    
                let label = svg.append("text").attr("visibility","hidden")    
               

                images.on("mouseover", function() {
                    d3.select(this).attr("opacity", 1);

                    let name = d3.select(this).datum()["Child's First Name"]
                    let gender = d3.select(this).datum()["Gender"]
                    let rank = d3.select(this).datum()["rank"]
                    //let ethnicity = d3.select(this).datum()["Ethnicity"]
                    let count = d3.select(this).datum()["overall_count"]

                    let allInfo = name 
                    //+ "\nGender: "+ gender + "\nRank: "+ rank +  "\nCount: " + count;

                    label.text(allInfo) 
                        .attr("x", d3.select(this).datum().x +200) 
                        .attr("y", (d3.select(this).datum().y + 310)) 
                        .attr("visibility", "visible")
                        .style("font-weight", "bold")

                    labelback.style("fill","white")
                        .attr("width", 120)
                        .attr("height", 100)
                        .attr("visibility","visible")
                        .attr("x", d3.select(this).datum().x + 190) 
                        .attr("y", (d3.select(this).datum().y + 290)) 
                        .style("stroke", "black")
                });

                images.on("mouseout", function() {
                    d3.select(this).attr("opacity","0.6")
                    label.text(""); 
                    labelback.style("fill","none").style("stroke", "none")
                });


                ranking(babies, 2011);

                function ranking(data, year) {

                    const rank = d3.select("#ranking");

                    rank.selectAll("table").remove();
                    console.log(data);
                    var filteredData = data.filter(function(d) {
                            return d['Year of Birth'] === 2011;
                        }).filter(function(d) {
                            return d['overall_count'] % 5 <= 1;
                        });                  
                    const table = rank.append("table"); // table for information
                    table.append("caption").text(`Top 5 Babies in ${year}`).style("font-weight", 600).style("font-size", "large"); // title
                    const tableTitle = table.append("thead");  // creating table title
                    tableTitle.append("th")
                        .selectAll("th")
                        .data(["State", year])
                        .enter()
                        .append("th")
                        .text(d => d);

                    
                    // creating table rows
                    const tableMain = table.append("tbody");
                    const rows = tableMain.selectAll("tr")
                                    .data(babies)
                                    .enter()
                                    .append("tr");

                    
                    // filling in the table data
                    rows.each(function (d) {
                    const row = d3.select(this);
                    row.append("td").text(d.State);
                    row.append("td").text(d[year].toFixed(2));
                    });




                }

            }
            requestData();
        </script>
        </div>

    </body>
</html>